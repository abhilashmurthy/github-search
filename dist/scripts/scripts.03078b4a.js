"use strict";function ResultCtrl(a,b,c){a.repo=c.getFocusedResult(),a.ok=function(){b.cancel()}}angular.module("githubSearchApp",["ngAnimate","ngAria","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","infinite-scroll"]).config(function(){}),angular.module("githubSearchApp").controller("GithubSearchCtrl",["$scope","GITHUB_CONFIG","APP_CONFIG","SearchData","ResultData","$interval",function(a,b,c,d,e,f){a.isWelcomeScreen=!0,a.isEnteringText=!1,a.hasResults=!1,a.isLoadingNextPage=!1,a.hasApiError=!1,a.toggleHomeScreen=function(b){b?(b.stopPropagation(),a.isWelcomeScreen=!0,a.$broadcast(c.resetNav),a.$broadcast(c.resetResults)):a.isWelcomeScreen=!1},a.$watch(function(){return d.isEnteringText()},function(b){"undefined"!=typeof b&&b.length&&(a.isEnteringText=b)}),a.$watch(function(){return e.isLoadingNextPage()},function(b){"undefined"!=typeof b&&(a.isLoadingNextPage=b)}),a.$watch(function(){return e.getTotalRepoCount()},function(b){"undefined"!=typeof b&&(a.hasResults=b>0)}),a.$watch(function(){return e.getApiError()},function(b){"undefined"!=typeof b&&b.length&&(a.hasApiError=b,e.reset(),a.refreshTimeRemaining=20,f(function(){--a.refreshTimeRemaining,a.refreshTimeRemaining||window.location.reload()},1e3))})}]),angular.module("githubSearchApp").controller("NavbarCtrl",["$scope","SearchData","APP_CONFIG","$timeout","$mdToast",function(a,b,c,d,e){function f(){return a.searchText&&0!==a.searchText.length?a.searchText.length<3?(e.show(e.simple().content("Please enter a keyword with at least 3 chars!").action("OK").position("bottom right").hideDelay(3e3).parent("md-toolbar.navbar")),!1):!0:!1}function g(){return a.searchCategories&&0!==a.searchCategories.length?!0:(e.show(e.simple().content("Please select at least one search category!").action("OK").position("bottom right").hideDelay(3e3).parent("md-toolbar.navbar")),!1)}a.searchText=null,a.searchCategories=[],a.isEnteringText=!1,a.categories=c.categories,a.defaultDebounce=c.debounce,a.$on(c.resetNav,function(){a.searchText=null,a.searchCategories=a.categories.map(function(a){return a.name})}),a.$watch("searchText",function(c){f()&&g()&&(console.log("Setting search data: "+c+a.searchCategories),b.setSearchData(c,a.searchCategories)),b.setEnteringText(!1)}),a.$watch("searchCategories",function(c,d){return d&&c.indexOf("none")>=0?void(a.searchCategories=d||[]):(f()&&g()&&b.setSearchData(a.searchText,c),void b.setEnteringText(!1))}),a.changeEnteringText=function(a){if(a){var c=a.which||a.keyCode;if(0===c||a.ctrlKey||a.metaKey||a.altKey)return b.setEnteringText(!1),!1}b.setEnteringText(!0)}}]),function(){angular.module("githubSearchApp").constant("GITHUB_CONFIG",{name:"Github Search Repositories v3",endpoint:"https://api.github.com/search/repositories",rate_limit_header:"x-ratelimit-remaining",response_array:"items",total_count:"total_count"})}(),angular.module("githubSearchApp").service("RepoManager",["$q","$http","GITHUB_CONFIG","Repo",function(a,b,c,d){return{searchRepos:function(e,f){var g=a.defer();return console.log("GET: "+c.endpoint+"?q="+e+"&page="+f),b.get(c.endpoint+"?q="+e+"&page="+f).success(function(a,b,e){for(var f={rate_limit_remaining:e()[c.rate_limit_header],total_count:a[c.total_count],repos:[]},h=0;h<a[c.response_array].length;h++)f.repos.push(new d(a[c.response_array][h]));g.resolve(f)}).error(function(a,b){if(console.log(b),403===b){var c={rate_limit_remaining:0};g.resolve(c)}}),g.promise}}}]).factory("Repo",function(){function a(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}return a}),angular.module("githubSearchApp").constant("APP_CONFIG",{debounce:500,rateLimitRemainingWarning:5,infiniteScrollDistance:0,sortOptions:[{label:"Full Name",value:"full_name",units:"alphabetical"},{label:"Owner Name",value:"owner.login",units:"alphabetical"},{label:"Language",value:"language",units:"buckets"},{label:"Follower Count",value:"followers",units:"buckets",bucketValues:["< 50","50 - 100","> 100"]}],resetNav:"resetNavCtrl",resetResults:"resetResultsCtrl",categories:[{name:"name",selected:!0,checkboxSelected:!0},{name:"description",selected:!0,checkboxSelected:!0},{name:"readme",selected:!0,checkboxSelected:!0}]}),angular.module("githubSearchApp").factory("SearchData",function(){var a={searchText:"",searchCategories:[],isEnteringText:!1};return{setSearchData:function(b,c){a.searchText=b,a.searchCategories=c},getSearchText:function(){return a.searchText},getSearchCategories:function(){return a.searchCategories},getSearchQuery:function(){var b=a.searchText;return b=b.concat(" in:"),b=b.concat(a.searchCategories.join(","))},isEnteringText:function(){return a.isEnteringText},setEnteringText:function(b){a.isEnteringText=b}}}),angular.module("githubSearchApp").controller("SummaryCtrl",["$scope","APP_CONFIG","SearchData","ResultData","$mdToast",function(a,b,c,d,e){a.totalRepoCount=0,a.searchText="",a.searchCategories=[],a.sortOptions=b.sortOptions,a.$watch(function(){return c.getSearchText()},function(b){"undefined"!=typeof b&&(a.searchText=b)}),a.$watch(function(){return c.getSearchCategories()},function(b){"undefined"!=typeof b&&(a.searchCategories=b)}),a.$watch(function(){return d.getTotalRepoCount()},function(b){return"undefined"!=typeof b?0===b?(e.show(e.simple().content("No results found...").position("bottom right").hideDelay(3e3).parent("md-toolbar.navbar")),void a.github.reset()):void(a.totalRepoCount=b):void 0})}]),ResultCtrl.$inject=["$scope","$mdDialog","ResultData"],angular.module("githubSearchApp").controller("ResultsCtrl",["$scope","SearchData","ResultData","APP_CONFIG","$mdToast","$mdDialog",function(a,b,c,d,e,f){a.github=c,a.infiniteScrollDistance=d.infiniteScrollDistance;var g=function(){a.github.reset()};a.$on(d.resetResults,function(){g()}),a.$watch(function(){return b.getSearchQuery()},function(b,c){b&&0!==b.length&&b!==c&&(g(),a.github.setSearchQuery(b))}),a.$watch(function(){return c.getRateLimitRemaining()},function(b){"undefined"!=typeof b&&b>=0&&b<d.rateLimitRemainingWarning&&(e.show(e.simple().content("API rate limit: "+b+" more times").position("bottom right").hideDelay(3e3).parent("md-toolbar.navbar")),0===b&&a.github.reset())}),a.showDialog=function(a){c.setFocusedResult(a),f.show({controller:ResultCtrl,templateUrl:"views/result.html"})}}]),angular.module("githubSearchApp").factory("ResultData",["$http","GITHUB_CONFIG",function(a,b){var c={searchQuery:"",repos:[],totalRepoCount:-1,currentPage:1,lastPage:1,isLoadingNextPage:!1,rateLimitRemaining:-1,apiError:"",focusedResult:{}},d=function(){return c.isLoadingNextPage?!1:c.searchQuery?c.currentPage>c.lastPage?!1:!0:!1},e=function(){if(d()){c.isLoadingNextPage=!0;var e=b.endpoint+"?q="+c.searchQuery+"&page="+c.currentPage;console.log("GET: "+e),a.get(e).success(function(a,d,e){200!==d?c.apiError=a[b.error_message]:(c.rateLimitRemaining=e()[b.rate_limit_header],c.repos=c.repos.concat(a[b.response_array]),c.totalRepoCount=a[b.total_count],1===c.lastPage&&(c.lastPage=Math.ceil(a[b.total_count]/c.repos.length)),c.currentPage<=c.lastPage&&c.currentPage++),c.isLoadingNextPage=!1}).error(function(a,b){a||(c.apiError="Connection Timeout: Unable to load Github API"),403===b&&(c.apiError="API limit reached"),c.isLoadingNextPage=!1})}};return{setSearchQuery:function(a){c.searchQuery=a,e()},fetchResults:e,getRepos:function(){return c.repos},getTotalRepoCount:function(){return c.totalRepoCount},isLoadingNextPage:function(){return c.isLoadingNextPage},getRateLimitRemaining:function(){return c.rateLimitRemaining},getApiError:function(){return c.apiError},reset:function(){c.searchQuery="",c.repos=[],c.totalRepoCount=-1,c.currentPage=1,c.lastPage=1,c.isLoadingNextPage=!1,c.rateLimitRemaining=-1,c.error="",c.focusedResult={}},setFocusedResult:function(a){c.focusedResult=a},getFocusedResult:function(){return c.focusedResult}}}]);